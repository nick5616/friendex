<!DOCTYPE html>
<html lang="en" class="fonts-loading">
    <head>
        <meta charset="UTF-8" />
        <link rel="icon" type="image/png" href="/icons/favicon-32x32.png" />
        <link
            rel="icon"
            type="image/png"
            sizes="32x32"
            href="/icons/favicon-32x32.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="192x192"
            href="/icons/android-chrome-192x192.png"
        />
        <link
            rel="icon"
            type="image/png"
            sizes="512x512"
            href="/icons/android-chrome512x512.png"
        />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="google-adsense-account" content="ca-pub-7645101328954208" />

        <!-- PWA Meta Tags -->
        <meta name="theme-color" content="#f59e0b" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="default" />
        <meta name="apple-mobile-web-app-title" content="Friendex" />
        <meta name="msapplication-TileColor" content="#f59e0b" />
        <meta name="msapplication-config" content="/browserconfig.xml" />

        <!-- Web App Manifest -->
        <link rel="manifest" href="/manifest.json" />

        <!-- Apple Touch Icons -->
        <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png" />
        <link
            rel="apple-touch-icon"
            sizes="152x152"
            href="/icons/apple-touch-icon.png"
        />
        <link
            rel="apple-touch-icon"
            sizes="180x180"
            href="/icons/apple-touch-icon.png"
        />
        <link
            rel="apple-touch-icon"
            sizes="167x167"
            href="/icons/apple-touch-icon.png"
        />

        <title>friendex</title>
        <!-- Local fonts for offline functionality -->
        <link rel="stylesheet" href="/fonts/gaegu.css" />
        <style>
            /* Hide app until Gaegu is ready to avoid FOUT */
            .fonts-loading #root {
                visibility: hidden;
            }
        </style>
    </head>
    <body>
        <div id="root"></div>
        <script>
            (async () => {
                try {
                    if (document.fonts && document.fonts.load) {
                        // If already available (cached), don't wait
                        const isReady =
                            document.fonts.check('1em "Gaegu"') ||
                            document.fonts.check('400 1em "Gaegu"');
                        if (!isReady) {
                            await Promise.all([
                                document.fonts.load('400 1em "Gaegu"'),
                                document.fonts.load('700 1em "Gaegu"'),
                            ]);
                        }
                    }
                } finally {
                    document.documentElement.classList.remove("fonts-loading");
                }
            })();
        </script>
        <script type="module" src="/src/main.jsx"></script>

        <!-- Service Worker Registration -->
        <script>
            if ("serviceWorker" in navigator) {
                window.addEventListener("load", () => {
                    navigator.serviceWorker
                        .register("/sw.js")
                        .then((registration) => {
                            console.log("SW registered: ", registration);
                            // Reload once when a new SW takes control to avoid stale HTML/assets
                            let hasRefreshed = false;
                            navigator.serviceWorker.addEventListener(
                                "controllerchange",
                                () => {
                                    if (hasRefreshed) return;
                                    hasRefreshed = true;
                                    window.location.reload();
                                }
                            );
                        })
                        .catch((registrationError) => {
                            console.log(
                                "SW registration failed: ",
                                registrationError
                            );
                        });
                });
            }
        </script>
    </body>
</html>
